# 在线调整缓冲池大小

## 原理

InnoDB 的缓冲池大小调整是基于事件驱动的，通过 `os_event_wait` 和 `os_event_set` 来实现。

## 流程

1. 服务启动的时候会创建一个线程 `buf_resize_thread` ，这个线程会等待 `srv_buf_resize_event` 事件。
2. 当 `srv_buf_resize_event` 事件被设置的时候，`buf_resize_thread` 线程会被唤醒，然后执行缓冲池大小调整的操作。
3. 执行的时候，会先检查设置的有效性
4. 如果检查通过，那么会计算需要增加或者回收的数据块，然后锁定整个缓冲池，进行数据块的分配和回收。
5. 整个过程会持续更新进度的状态，直到完成。
